% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analyze_trends_by_spatial_unit.R
\name{analyze_trends_by_spatial_unit}
\alias{analyze_trends_by_spatial_unit}
\title{Summarize Temporal Patterns and Trends by Spatial Unit}
\usage{
analyze_trends_by_spatial_unit(
  shapefile_path,
  name_field,
  binary_stack,
  pattern_raster,
  year_decrease_raster,
  year_increase_raster,
  time_steps,
  output_dir = "output/spatial_analysis",
  overwrite = FALSE,
  pie_scale = 1
)
}
\arguments{
\item{shapefile_path}{Character, sf object, or sfc object. Can be: (1) path
to a shapefile, (2) path to a directory containing a single .shp file,
(3) an sf object, or (4) an sfc geometry object. Spatial units are used
for aggregation (e.g., administrative boundaries, watersheds).}

\item{name_field}{Character. Name of the attribute field in the shapefile to
use as spatial unit identifiers.}

\item{binary_stack}{SpatRaster or character. Stack of binary prediction
rasters across time, or path to raster file. Typically from
\code{\link{summarize_raster_outputs}}.}

\item{pattern_raster}{SpatRaster or character. Pattern classification raster
from \code{\link{analyze_temporal_patterns}}, or path to raster file.}

\item{year_decrease_raster}{SpatRaster or character. Raster showing time
period of first decrease from \code{\link{analyze_temporal_patterns}}, or
path to raster file.}

\item{year_increase_raster}{SpatRaster or character. Raster showing time
period of first increase from \code{\link{analyze_temporal_patterns}}, or
path to raster file.}

\item{time_steps}{Vector. Time period labels corresponding to layers in
binary_stack.}

\item{output_dir}{Character. Output directory for summary tables and plots.
Default is "output/spatial_analysis".}

\item{overwrite}{Logical. If TRUE, overwrites existing output files. If
FALSE, loads existing files when available. Default is FALSE.}

\item{pie_scale}{Numeric. Scaling factor for pie chart sizes in the map.
Values > 1 make pies larger, values < 1 make them smaller. Default is 1.}
}
\value{
A list containing:
\itemize{
  \item overall_summary: Data frame with pattern composition statistics for
    each spatial unit
  \item yearly_summary: Data frame with habitat pixel counts by spatial unit
    and time period
  \item change_by_year: Data frame with gain/loss pixel counts by spatial
    unit and time period
  \item plots: List of ggplot objects including pattern map, time series,
    annual change, change by unit, total change, and faceted change plots
}
}
\description{
Postprocessing function that aggregates temporal pattern classifications and
habitat change metrics across user-defined spatial units (e.g., states,
countries, watersheds). Generates summary tables and visualizations showing
how habitat suitability patterns and trends vary spatially.
}
\details{
For each spatial unit, the function extracts and summarizes:
\itemize{
  \item Pattern composition: Counts and percentages of pixels classified as
    Never Suitable, Always Suitable, No Pattern, Increasing, Decreasing, or
    Fluctuating
  \item Temporal habitat availability: Number of suitable pixels in each time
    period
  \item Change events: Number of pixels experiencing first increase or
    decrease in each time period
}

Generated visualizations include:
\enumerate{
  \item Scatterpie map showing pattern composition for each spatial unit
  \item Time series line plot of habitat availability over time
  \item Bar plot of total gains and losses by time period
  \item Stacked bar plot of gains and losses by spatial unit
  \item Bar plot of total gains and losses by spatial unit
  \item Faceted plots showing temporal trends within each spatial unit
}

Spatial units with names containing "city" (case-insensitive) are
automatically filtered out during analysis.
}
\examples{
\dontrun{
spatial_results <- analyze_trends_by_spatial_unit(
  shapefile_path = "admin_boundaries.shp",
  name_field = "STATE_NAME",
  binary_stack = "consensus_predictions/Binary_Rasters",
  pattern_raster = "temporal_patterns/Pattern_Classification.tif",
  year_decrease_raster = "temporal_patterns/Year_First_Decrease.tif",
  year_increase_raster = "temporal_patterns/Year_First_Increase.tif",
  time_steps = 2000:2020,
  output_dir = "spatial_analysis/"
)

spatial_units_sf <- st_read("admin_boundaries.shp")
spatial_results <- analyze_trends_by_spatial_unit(
  shapefile_path = spatial_units_sf,
  name_field = "STATE_NAME",
  binary_stack = binary_rasters,
  pattern_raster = pattern_rast,
  year_decrease_raster = decrease_rast,
  year_increase_raster = increase_rast,
  time_steps = 2000:2020,
  pie_scale = 1.5
)
}

}
\seealso{
Postprocessing: \code{\link{summarize_raster_outputs}},
\code{\link{analyze_temporal_patterns}}
}
